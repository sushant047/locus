	<!doctype html>
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><html lang="en" class="no-js"> <![endif]-->
<html lang="en">

<head>

    <!-- Basic -->
    <title>Locus</title>

    <!-- Define Charset -->
    <meta charset="utf-8">

    <!-- Responsive Metatag -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Page Description and Author -->
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap CSS  -->
    <link rel="stylesheet" href="asset/css/bootstrap.min.css" type="text/css" media="screen">

    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" media="screen">

    <!-- Margo CSS Styles  -->
    <link rel="stylesheet" type="text/css" href="css/style.css" media="screen">

    <!-- Responsive CSS Styles  -->
    <link rel="stylesheet" type="text/css" href="css/responsive.css" media="screen">

    <!-- Css3 Transitions Styles  -->
    <link rel="stylesheet" type="text/css" href="css/animate.css" media="screen">

    <!-- Color CSS Styles  -->
    <link rel="stylesheet" type="text/css" href="css/colors/red.css" title="red" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/jade.css" title="jade" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/green.css" title="green" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/blue.css" title="blue" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/beige.css" title="beige" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/cyan.css" title="cyan" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/orange.css" title="orange" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/peach.css" title="peach" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/pink.css" title="pink" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/purple.css" title="purple" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/sky-blue.css" title="sky-blue" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/colors/yellow.css" title="yellow" media="screen" />


    <!-- Margo JS  -->
    <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/jquery.migrate.js"></script>
    <script type="text/javascript" src="js/modernizrr.js"></script>
    <script type="text/javascript" src="asset/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="js/nivo-lightbox.min.js"></script>
    <script type="text/javascript" src="js/jquery.isotope.min.js"></script>
    <script type="text/javascript" src="js/jquery.appear.js"></script>
    <script type="text/javascript" src="js/count-to.js"></script>
    <script type="text/javascript" src="js/jquery.textillate.js"></script>
    <script type="text/javascript" src="js/jquery.lettering.js"></script>
    <script type="text/javascript" src="js/jquery.easypiechart.min.js"></script>
    <script type="text/javascript" src="js/jquery.nicescroll.min.js"></script>
    <script type="text/javascript" src="js/jquery.parallax.js"></script>
    <script type="text/javascript" src="js/mediaelement-and-player.js"></script>
    <script type="text/javascript" src="js/script.js"></script>

    <!--[if IE 8]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <style>
   @font-face {
  font-family: 'Glyphicons Halflings';
  src: url('fonts/glyphicons-halflings-regular.eot');
  src: url('fonts/glyphicons-halflings-regular.eot?#iefix') format('embedded-opentype'), 
  url('../fonts/glyphicons-halflings-regular.woff') format('woff'), 
  url('../fonts/glyphicons-halflings-regular.ttf') format('truetype'), 
  url('../fonts/glyphicons-halflings-regular.svg#glyphicons-halflingsregular') format('svg');
}
	</style>

</head>

<body>

    <!-- Full Body Container -->
    <div id="container">
        
        
        <!-- Start Header Section --> 
        <div class="hidden-header"></div>

        
        
        <!-- Start Home Page Slider -->
        <section id="home">
            <!-- Carousel -->
            <div id="main-slide" class="carousel slide" data-ride="carousel">


                <!-- Carousel inner -->
                <div class="carousel-inner">
                    <div class="item active">
                        <img class="img-responsive" src="images/bg1.jpg">
                        <div class="slider-content">
                            <div class="col-sm-12 text-center">
                                <h2 class="animated2">
                        		  <span>Welcome to <strong>Locus</strong></span>
                        	    </h2>
                                <form action="" method="POST">
                                    <div class="control-group" style="margin-left: 30%; margin-right: 30%; margin-top: 5%;">
                                        <p class="animation3"><input id="search" name="search" type="text" placeholder="Search Location..." class="input-medium form-control"></p>
                                    </div>
                                <p class="animated4"><input type="submit" class="slider btn btn-primary"></p>
                            </form>
                            </div>
                        </div>
                    </div>
    
                </div>

            </div>
            <!-- /carousel -->
        </section>
        <!-- End Home Page Slider -->
        
        
        <!-- Start Services Section -->
        <div id="hide" class="section service" style="margin-top:0px;padding-top: 40px;">
            <div class="container">
            <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12" style="margin-bottom:30px;">
            <p id="ttl"></p>
            </div>
            </div>
                <div class="row">
                    <!-- Start Service Icon 1 -->
                    <a href="#lodgings" data-toggle="modal"><div class="col-md-3 col-sm-6 service-box service-center" data-animation="fadeIn" data-animation-delay="01">
                        <div class="service-icon">
                            <i class="fa fa-home icon-large"></i>
                        </div>
                        <div class="service-content">
                            <h4>Lodging</h4>
                            <p id="lodging"></p>

                        </div>
                    </div>
                    </a>
                    <!-- End Service Icon 1 -->

                    <!-- Start Service Icon 2 -->
                    <a href="#hospitals" data-toggle="modal"><div class="col-md-3 col-sm-6 service-box service-center" data-animation="fadeIn" data-animation-delay="02">
                        <div class="service-icon">
                            <i class="fa fa-plus icon-large"></i>
                        </div>
                        <div class="service-content">
                            <h4>Hospitals</h4>
                            <p id="hospital"></p>
                        </div>
                    </div>
                </a>
                    <!-- End Service Icon 2 -->

                    <!-- Start Service Icon 3 -->
                    <a href="#restaurants" data-toggle="modal"><div class="col-md-3 col-sm-6 service-box service-center" data-animation="fadeIn" data-animation-delay="03">
                        <div class="service-icon">
                            <i class="fa fa-spoon icon-large"></i>
                        </div>
                        <div class="service-content">
                            <h4>Restaurants</h4>
                            <p id="restaurant"></p>
                            <p></p>
                        </div>
                    </div>
                </a>
                    <!-- End Service Icon 3 -->

                    <!-- Start Service Icon 4 -->
                    <a href="#"><div class="col-md-3 col-sm-6 service-box service-center" data-animation="fadeIn" data-animation-delay="04">
                        <div class="service-icon">
                            <i class="fa fa-money icon-large"></i>
                        </div>
                        <div class="service-content">
                            <h4>ATM</h4>
                            <p id="atm"></p>
                        </div>
                    </div>
                </a>
                    <!-- End Service Icon 4 -->

                </div><!-- .row -->
                <div class="row">
	            <div class="col-md-12 col-sm-12 col-xs-12">
	            <p id="lc"></p>
	            </div>
	            </div>
            </div><!-- .container -->
        </div>
        <!-- End Services Section -->

        
        
        
        <!-- Start Footer Section -->
        <footer>
            <div class="container">


                <!-- Start Copyright -->
                <div class="copyright-section">
                    <div class="row">
                        <div class="col-md-6">
                 
                        </div>
                        <div class="col-md-6">
                          
                        </div><!-- .col-md-6 -->
                    </div><!-- .row -->
                </div>
                <!-- End Copyright -->

            </div>
        </footer>
        <!-- End Footer Section -->
        
        
    </div>
    <!-- End Full Body Container -->

    <!-- Go To Top Link -->
    <a href="#" class="back-to-top"><i class="fa fa-angle-up"></i></a>

    <div id="loader">
        <div class="spinner">
            <div class="dot1"></div>
            <div class="dot2"></div>
        </div>
    </div>
<!-- modals -->
    <div class="modal fade" id="lodgings" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Top Lodges</h4>
                </div>
                <div class="modal-body">
                    <p id="lodging-modal"></p>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-danger" data-dismiss="modal">Close</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="hospitals" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Top Hospitals</h4>
                </div>
                <div class="modal-body">
                    <p id="hospital-modal"></p>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-danger" data-dismiss="modal">Close</a>
                </div>
            </div>
        </div>
    </div>

       <div class="modal fade" id="restaurants" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Top Restaurants</h4>
                </div>
                <div class="modal-body">
                    <p id="restaurant-modal"></p>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-danger" data-dismiss="modal">Close</a>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<?php
if (isset($_POST['search'])){
	require 'connect.inc.php';
		$key="AIzaSyCB2hShzBxMYPnkwpZzSQUnpxZm-QBYmSk";
	
	$location=$_POST['search'];
	$replace=str_ireplace(" ","+",$location);
	$url="https://maps.googleapis.com/maps/api/geocode/json?address=".$replace."&key=".$key;
	$json=file_get_contents($url);
	$res=json_decode($json);
	
	function objectToArray($d) 
	{
	    if (is_object($d)) {
	        // Gets the properties of the given object
	        // with get_object_vars function
	        $d = get_object_vars($d);
	    }

	    if (is_array($d)) {
	        return array_map(__FUNCTION__, $d);
	    } else {
	        // Return array
	        return $d;
	    }
	}
	$assoc_array = objectToArray($res);
	$lat=$assoc_array['results']['0']['geometry']['location']['lat'];
	$long=$assoc_array['results']['0']['geometry']['location']['lng'];

	$cat=array("restaurant","hospital","lodging","atm");
	mysql_query("TRUNCATE table nearby") or die(mysql_error());
	for($i=0;$i<4;$i++)
	{
	$url="https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=".$lat.",".$long."&radius=3000&types=".$cat[$i]."&key=".$key;
	$json=file_get_contents($url);
	$res=json_decode($json);

	$new_array = objectToArray($res);
	$k=count($new_array['results']);
	for($j=0; $j<$k; $j++){
	$name=addslashes($new_array['results'][$j]['name']);

	if(isset($new_array['results'][$j]['rating'])){
		$rating=$new_array['results'][$j]['rating'];
		$rating=floatval($rating);
	}
	else
	{
		$rating=-1.0;
	}
	$query="INSERT INTO nearby (category,name,rating) VALUES ('$cat[$i]','$name',$rating)" ;
	mysql_query($query) or die(mysql_error());
	}
	
}

	$cummulative=0.0;
	$ratings=array();
	for($i=0;$i<3;$i++)
	{
	$count=0.0;
	$rate=0.0;
	$result=mysql_query("SELECT rating from nearby where category='$cat[$i]'") or die(mysql_error());
	while($row=mysql_fetch_array($result)){
		if($row[0]==-1.0){
			//continue;
		}
		
		else if($row[0]>0.0 && $row[0]<=1.0){
			$rate=$rate+0.0;
			$count=$count+1.0;
		}
		else if($row[0]>1.0 && $row[0]<=2.0){
			$rate=$rate+1.0;
			$count=$count+1.0;
		}
		else if($row[0]>2.0 && $row[0]<=3.0){
			$rate=$rate+2.5;
			$count=$count+1.0;
		}
		else if($row[0]>3.0 && $row[0]<=4.0){
			$rate=$rate+4.0;
			$count=$count+1.0;
		}
		else if($row[0]>4.0 && $row[0]<=5.0){
			$rate=$rate+5.0;
			$count=$count+1.0;
		}

	}
	if($count==0.0){
		$rate=0.0;
	}
	else{
		$rate=$rate/$count;
	}
	$rate=$rate*2.0;
	$rate=round($rate,1);
	array_push($ratings,$rate);
	$cummulative+=$rate;
	echo '<script>
		$("#'.$cat[$i].'").append("<h2 style=\"color:red\">'.$rate.'</h2><i class=\"fa fa-star\" style=\"color:red\"></i>");
		</script>';
	$top=mysql_query("select name,rating from nearby where category='$cat[$i]' order by rating desc limit 5");
	while($row=mysql_fetch_array($top)){
		echo '<script>
		$("#'.$cat[$i].'-modal").append("<h3>'.$row[0].'</h3>");
		</script>';
	}
	
}

	$result=mysql_query("SELECT * from nearby where category='$cat[3]'") or die(mysql_error());
	$num=mysql_num_rows($result);
	$num=floatval($num)/2.0;
	$num=round($num,1);
	array_push($ratings,$num);
	$cummulative+=$num;
	//echo "atms rating: ".$num;
	echo '<script>
		$("#atm").append("<h2 style=\"color:red\">'.$num.'</h2><i class=\"fa fa-star\" style=\"color:red\"></i>");
		</script>';

	$cummulative=$cummulative/4.0;
	$net_value=0.0;
	for($i=0;$i<4;$i++){
		$net_value=$net_value+abs($ratings[$i]-$cummulative);
	}
	echo '<br>';
	$net_value= $net_value/4.0;
	$net_value=10-$net_value;
	$net_value=round($net_value,1);
	echo '<script>
		$("#lc").append("<h2 style=\"color:#2c8dc5;text-align: center;\">Place Rating: <span style=\"color:red;\">'.$net_value.'</span><i class=\"fa fa-star\" style=\"color:red\"></i>");
		</script>';
	echo '<script>
		$("#ttl").append("<h2 style=\"color:#2c8dc5;text-align: center;\">Location: '.strtoupper($_POST['search']).'");
		</script>';
}
	?>